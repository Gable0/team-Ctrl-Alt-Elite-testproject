<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RetroGa Skins Library</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=DotGothic16&family=Doto:wght@100..900&family=Nabla&family=Press+Start+2P&family=Tourney:ital,wght@0,100..900;1,100..900&family=Jersey+10&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <skins-container>
      <skins-header>
        <h1 translate="skinsHeader">RetroGa Skins Library</h1>
        <p translate="skinsSubheader">
          Equip your favorite looks for ships and enemies!
        </p>
      </skins-header>

      <section class="skins-grid" id="skins-grid">
        <!-- JS will fill this -->
      </section>

      <button id="back-shop" translate="backToShop">Back to Shop</button>
      <button id="back-homepage" translate="backToHome">Back to Home</button>
    </skins-container>

    <script type="module">
      import { injectSettings } from './js/ui/settingsComponent.js';
      import { persistentAudio } from './js/core/persistentAudio.js';

      injectSettings();

      // FIXED: Use persistentAudio navigation
      document.getElementById('back-shop').addEventListener('click', e => {
        e.preventDefault();
        persistentAudio.navigateTo('shop.html');
      });

      document.getElementById('back-homepage').addEventListener('click', e => {
        e.preventDefault();
        persistentAudio.navigateTo('index.html');
      });
    </script>

    <script type="module">
      import {
        getActiveSkin,
        isSkinOwned,
        equipSkin,
      } from './js/skins/skinsManager.js';

      function initSkins() {
        console.log('üé® initSkins() called');
        const grid = document.getElementById('skins-grid');
        if (!grid) {
          console.log('‚è≥ Grid not found, retrying...');
          setTimeout(initSkins, 50);
          return;
        }

        console.log('‚úÖ Grid found, checking skins...');

        // Clear any existing content
        grid.innerHTML = '';

        const activeSkin = getActiveSkin();
        console.log('Active skin:', activeSkin);

        // Check what's in localStorage
        console.log(
          'squarePackOwned:',
          localStorage.getItem('squarePackOwned')
        );
        console.log('starPackOwned:', localStorage.getItem('starPackOwned'));
        console.log('profOwned:', localStorage.getItem('profOwned'));

        function addSkin(skinId, name, desc) {
          const owned = isSkinOwned(skinId);
          console.log(`Checking ${skinId}: owned = ${owned}`);

          if (!owned) return;

          const card = document.createElement('article');
          card.className = 'skin-card';
          card.innerHTML = `
        <h3>${name}</h3>
        <p>${desc}</p>
        <button class="equip-btn">
          ${activeSkin === skinId ? 'Equipped' : 'Equip'}
        </button>
      `;
          grid.appendChild(card);

          card.querySelector('button').addEventListener('click', () => {
            equipSkin(activeSkin === skinId ? 'default' : skinId);
            location.reload();
          });
        }

        addSkin(
          'squarePack',
          'Square Pack',
          'Blocky vibes for ships and foes.'
        );
        addSkin('starPack', 'Star Pack', 'Stellar shapes for ships and foes.');
        addSkin('prof', 'Prof Pack', 'The Professor invades your fleet!');

        console.log(`üìä Total skins shown: ${grid.children.length}`);

        if (grid.children.length === 0) {
          const emptyMsg = document.createElement('p');
          emptyMsg.textContent = 'No skins owned yet. Visit the shop!';
          emptyMsg.style.textAlign = 'center';
          emptyMsg.style.gridColumn = '1 / -1';
          grid.appendChild(emptyMsg);
        }
      }

      // Initialize immediately
      initSkins();
    </script>

    <script type="module">
      import { applyTranslations } from './js/ui/translations.js';
      applyTranslations(document);
      window.addEventListener('languagechange', () =>
        applyTranslations(document)
      );
    </script>
  </body>
</html>
