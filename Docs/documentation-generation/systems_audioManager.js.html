<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: systems/audioManager.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: systems/audioManager.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// js/systems/audioManager.js
// Central audio system â€“ handles SFX, music, fun-mode toggle and volume control.

class AudioManager {
  constructor() {
    /** @type {Object&lt;string, HTMLAudioElement>} */
    this.sounds = {};
    /** @type {boolean} */
    this.enabled = true;
    /** @type {number} Master volume for sound effects (0â€“1) */
    this.volume = 0.5;
    /** @type {number} Volume for background music (0â€“1) */
    this.musicVolume = 0.3;
    /** @type {HTMLAudioElement|null} Currently playing music track */
    this.currentMusic = null;
    /** @type {string|null} Name of currently playing music */
    this.currentMusicName = null;
    /** @type {number|null} Active fade interval ID */
    this.fadeInterval = null;

    // Load fun-mode preference once at startup
    const savedFunMode = localStorage.getItem('funMode');
    /** @type {boolean} */
    this.funMode = savedFunMode === 'true';
    console.log(`AudioManager initialized - Fun mode: ${this.funMode}`);
  }

  /**
   * Loads an audio file into the manager.
   *
   * @param {string} name      Unique identifier for the sound.
   * @param {string} path      Relative or absolute URL to the audio file.
   * @param {boolean} [isMusic=false] If true the sound will loop and use musicVolume.
   */
  loadSound(name, path, isMusic = false) {
    try {
      console.log(`Loading sound: ${name} from ${path}`);
      const audio = new Audio(path);
      audio.preload = 'auto';
      audio.volume = isMusic ? this.musicVolume : this.volume;

      if (isMusic) {
        audio.loop = true;
      }

      // Add event listeners to track loading
      audio.addEventListener('canplaythrough', () => {
        console.log(`âœ“ Successfully loaded: ${name}`);
      });

      audio.addEventListener('error', e => {
        console.error(`âœ— Failed to load: ${name}`, e);
      });

      this.sounds[name] = audio;
    } catch (error) {
      console.error(`Failed to load sound: ${name}`, error);
    }
  }

  /**
   * Plays a sound effect (clones the source to allow overlapping playback).
   *
   * @param {string} name Identifier of the sound to play.
   */
  playSound(name) {
    if (!this.enabled) {
      console.log('Audio is disabled');
      return;
    }

    if (!this.sounds[name]) {
      console.warn(`Sound not found: ${name}`);
      console.log('Available sounds:', Object.keys(this.sounds));
      return;
    }

    console.log(`Playing sound: ${name}`);

    try {
      const sound = this.sounds[name].cloneNode();
      sound.volume = this.volume;
      sound
        .play()
        .then(() => console.log(`Successfully played: ${name}`))
        .catch(err => console.warn(`Failed to play: ${name}`, err));
    } catch (error) {
      console.error(`Error playing sound: ${name}`, error);
    }
  }

  /**
   * Starts playback of a music track (stops any currently playing music first).
   *
   * @param {string} name Identifier of the music track.
   * @param {boolean} [fade=false] Whether to fade in the music.
   */
  playMusic(name, fade = false) {
    if (!this.enabled) {
      console.log('Audio is disabled');
      return;
    }

    if (!this.sounds[name]) {
      console.error(`âŒ Music not found: ${name}`);
      console.log('Available music tracks:', Object.keys(this.sounds));
      return;
    }

    // Don't restart if already playing this track
    if (
      this.currentMusicName === name &amp;&amp;
      this.currentMusic &amp;&amp;
      !this.currentMusic.paused
    ) {
      console.log(`Music ${name} is already playing`);
      return;
    }

    this.stopMusic();

    console.log(`ðŸŽµ Starting music: ${name}${fade ? ' (with fade-in)' : ''}`);

    try {
      this.currentMusic = this.sounds[name];
      this.currentMusicName = name;
      this.currentMusic.currentTime = 0;

      if (fade) {
        // Start at volume 0 and fade in
        this.currentMusic.volume = 0;
        this.currentMusic
          .play()
          .then(() => {
            console.log(`âœ“ Successfully started music: ${name}`);
            this.fadeIn();
          })
          .catch(err => {
            console.error(`âœ— Failed to play music: ${name}`, err);
            console.log(
              'This might be due to autoplay restrictions. Try interacting with the page.'
            );
          });
      } else {
        // Normal playback at full volume
        this.currentMusic.volume = this.musicVolume;
        this.currentMusic
          .play()
          .then(() => console.log(`âœ“ Successfully started music: ${name}`))
          .catch(err => {
            console.error(`âœ— Failed to play music: ${name}`, err);
            console.log(
              'This might be due to autoplay restrictions. Try interacting with the page.'
            );
          });
      }
    } catch (error) {
      console.error(`Error playing music: ${name}`, error);
    }
  }

  /**
   * Fades in the currently playing music over 2 seconds.
   */
  fadeIn() {
    if (!this.currentMusic) return;

    // Clear any existing fade
    if (this.fadeInterval) {
      clearInterval(this.fadeInterval);
    }

    const fadeDuration = 2000; // 2 seconds
    const fadeSteps = 50;
    const volumeIncrement = this.musicVolume / fadeSteps;
    const stepDuration = fadeDuration / fadeSteps;

    let currentStep = 0;
    this.fadeInterval = setInterval(() => {
      if (!this.currentMusic) {
        clearInterval(this.fadeInterval);
        return;
      }

      currentStep++;
      this.currentMusic.volume = Math.min(
        currentStep * volumeIncrement,
        this.musicVolume
      );

      if (currentStep >= fadeSteps) {
        clearInterval(this.fadeInterval);
        this.currentMusic.volume = this.musicVolume;
        this.fadeInterval = null;
        console.log('âœ“ Fade-in complete');
      }
    }, stepDuration);
  }

  /** Stops the currently playing music (if any). */
  stopMusic() {
    if (this.fadeInterval) {
      clearInterval(this.fadeInterval);
      this.fadeInterval = null;
    }

    if (this.currentMusic) {
      console.log(`ðŸ›‘ Stopping current music: ${this.currentMusicName}`);
      this.currentMusic.pause();
      this.currentMusic.currentTime = 0;
      this.currentMusic = null;
      this.currentMusicName = null;
    }
  }

  /**
   * Plays level-appropriate background music based on current level.
   *
   * @param {number} level - Current game level
   * @param {boolean} [fade=false] - Whether to fade in the music
   */
  playLevelMusic(level, fade = false) {
    let musicName;

    if (level >= 1 &amp;&amp; level &lt;= 2) {
      musicName = 'background-music-1-2';
    } else if (level >= 3 &amp;&amp; level &lt;= 4) {
      musicName = 'background-music-3-4';
    } else {
      musicName = 'background-music-5';
    }

    console.log(`ðŸŽ® Level ${level} â†’ Playing: ${musicName}`);
    this.playMusic(musicName, fade);
  }

  /** Plays the game over background music */
  playGameOverMusic() {
    console.log('ðŸ’€ Playing game over background music');
    this.playMusic('game-over-background');
  }

  /** Plays the appropriate shoot sound â€“ uses "chloe-shoot" when fun mode is active. */
  playShootSound() {
    // Re-read fun mode from storage each shot (in case it changed via settings)
    const currentFunMode = localStorage.getItem('funMode') === 'true';
    this.funMode = currentFunMode;

    const soundName = this.funMode ? 'chloe-shoot' : 'player-shoot';
    this.playSound(soundName);
  }

  /** Plays the enemy kill sound effect. */
  playKillEnemySound() {
    if (!this.enabled) {
      console.log('Audio is disabled');
      return;
    }

    if (!this.sounds['kill-enemy']) {
      console.warn('Sound not found: kill-enemy');
      return;
    }

    console.log('Playing sound: kill-enemy');

    try {
      const sound = this.sounds['kill-enemy'].cloneNode();
      sound.volume = this.volume;

      sound
        .play()
        .then(() => {
          console.log('Successfully played: kill-enemy');
        })
        .catch(err => console.warn('Failed to play: kill-enemy', err));
    } catch (error) {
      console.error('Error playing sound: kill-enemy', error);
    }
  }

  /** Plays the laser hits player sound effect. */
  playLaserHitsPlayerSound() {
    console.log('ðŸ’¥ Laser hit player!');
    this.playSound('laser-hits-player');
  }

  /** Plays the enemy hits player sound effect. */
  playEnemyHitsPlayerSound() {
    console.log('ðŸ’¥ Enemy hit player!');
    this.playSound('enemy-hits-player');
  }

  /** Plays the game-over sound effect and background music. */
  playGameOverSound() {
    console.log('ðŸ’€ Playing game over sound sequence');
    this.stopMusic();

    // Play game over background music first
    this.playGameOverMusic();

    // Then play game over sound effect after a short delay
    setTimeout(() => {
      this.playSound('game-over');
    }, 500);
  }

  /** Plays the start-game sound effect and stops any intro music. */
  playStartGameSound() {
    console.log('ðŸš€ Playing start game sound');
    this.stopMusic();
    this.playSound('start-game');
  }

  /** Plays the power-up collection sound effect. */
  playPowerUpSound() {
    this.playSound('power-up');
  }

  /**
   * Enables or disables fun mode (Chloe shooting sound).
   *
   * @param {boolean} enabled
   */
  setFunMode(enabled) {
    this.funMode = enabled;
    localStorage.setItem('funMode', String(enabled));
    console.log(`Fun mode ${enabled ? 'ENABLED' : 'DISABLED'}`);
  }

  /** @returns {boolean} Current fun-mode state (reads from localStorage). */
  getFunMode() {
    const saved = localStorage.getItem('funMode') === 'true';
    this.funMode = saved;
    return this.funMode;
  }

  /**
   * Sets master volume for sound effects.
   *
   * @param {number} newVolume Value between 0 and 1.
   */
  setVolume(newVolume) {
    this.volume = Math.max(0, Math.min(1, newVolume));
    // Apply to all existing SFX sounds
    Object.values(this.sounds).forEach(sound => {
      if (!sound.loop) {
        // SFX, not music
        sound.volume = this.volume;
      }
    });
    localStorage.setItem('sfxVolume', this.volume);
  }

  /**
   * Sets volume for background music.
   *
   * @param {number} newVolume Value between 0 and 1.
   */
  setMusicVolume(newVolume) {
    this.musicVolume = Math.max(0, Math.min(1, newVolume));
    // Apply to current music if playing
    if (this.currentMusic) {
      this.currentMusic.volume = this.musicVolume;
    }
    localStorage.setItem('musicVolume', this.musicVolume);
  }

  /** Returns current music volume (0â€“1) */
  getMusicVolume() {
    return this.musicVolume;
  }

  /** Returns current sound-effects volume (0â€“1) */
  getSFXVolume() {
    return this.volume;
  }
}

/** Singleton instance used throughout the game. */
export const audioManager = new AudioManager();

/**
 * Initializes all game audio assets.
 * Called once at game startup (e.g. from gameLoop.js).
 */
export function initAudio() {
  console.log('ðŸŽµ Initializing audio system...');

  // Sound effects
  audioManager.loadSound('shoot', 'assets/sounds/reg game sounds/shoot.wav');
  audioManager.loadSound(
    'player-shoot',
    'assets/sounds/reg game sounds/player-shoot.wav'
  );
  audioManager.loadSound('chloe-shoot', 'assets/sounds/Chloe-shooting.wav');
  audioManager.loadSound(
    'kill-enemy',
    'assets/sounds/reg game sounds/kill-enemy.wav'
  );
  audioManager.loadSound(
    'game-over',
    'assets/sounds/reg game sounds/game-over.wav'
  );
  audioManager.loadSound(
    'start-game',
    'assets/sounds/reg game sounds/start-game.wav'
  );
  audioManager.loadSound(
    'power-up',
    'assets/sounds/reg game sounds/power-up.wav'
  );
  audioManager.loadSound(
    'laser-hits-player',
    'assets/sounds/reg game sounds/laser-hits-player.wav'
  );
  audioManager.loadSound(
    'enemy-hits-player',
    'assets/sounds/reg game sounds/enemy-hits-player.wav'
  );

  // Background music (looped)
  audioManager.loadSound(
    'intro',
    'assets/sounds/reg game sounds/intro.wav',
    true
  );
  audioManager.loadSound(
    'background-music-1-2',
    'assets/sounds/reg game sounds/background-music-1-2.wav',
    true
  );
  audioManager.loadSound(
    'background-music-3-4',
    'assets/sounds/reg game sounds/background-music-3-4.wav',
    true
  );
  audioManager.loadSound(
    'background-music-5',
    'assets/sounds/reg game sounds/background-music-5.wav',
    true
  );
  audioManager.loadSound(
    'game-over-background',
    'assets/sounds/reg game sounds/game-over-background.wav',
    true
  );

  console.log(
    `âœ“ Audio initialized with fun mode: ${audioManager.getFunMode()}`
  );
  console.log('ðŸ“‹ Loaded sounds:', Object.keys(audioManager.sounds));
}

/** Placeholder â€“ not currently used (intro music is handled by persistentAudio.js). */
export function playBackgroundGameMusic() {
  audioManager.playMusic('background-game');
}

/** Legacy helper â€“ kept for compatibility, but intro music is now managed by persistentAudio.js. */
export function playIntroMusic() {
  audioManager.playMusic('intro');
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="PersistentAudioManager.html">PersistentAudioManager</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Game">Game</a></li><li><a href="global.html#advanceEnemyAlongPath">advanceEnemyAlongPath</a></li><li><a href="global.html#audioManager">audioManager</a></li><li><a href="global.html#barrierY">barrierY</a></li><li><a href="global.html#boxesOverlap">boxesOverlap</a></li><li><a href="global.html#canvas">canvas</a></li><li><a href="global.html#canvasRef">canvasRef</a></li><li><a href="global.html#checkEnemyShotCollisions">checkEnemyShotCollisions</a></li><li><a href="global.html#checkPlayerEnemyCollision">checkPlayerEnemyCollision</a></li><li><a href="global.html#checkPlayerShotCollisions">checkPlayerShotCollisions</a></li><li><a href="global.html#createEnemy">createEnemy</a></li><li><a href="global.html#createInitialGame">createInitialGame</a></li><li><a href="global.html#createPlayer">createPlayer</a></li><li><a href="global.html#createPlayerShot">createPlayerShot</a></li><li><a href="global.html#ctx">ctx</a></li><li><a href="global.html#ctxRef">ctxRef</a></li><li><a href="global.html#draw">draw</a></li><li><a href="global.html#drawBackground">drawBackground</a></li><li><a href="global.html#drawEnemies">drawEnemies</a></li><li><a href="global.html#drawEnemyShots">drawEnemyShots</a></li><li><a href="global.html#drawPlayer">drawPlayer</a></li><li><a href="global.html#drawPlayerShots">drawPlayerShots</a></li><li><a href="global.html#enemyTypes">enemyTypes</a></li><li><a href="global.html#equipSkin">equipSkin</a></li><li><a href="global.html#fireEnemyShot">fireEnemyShot</a></li><li><a href="global.html#formationConfig">formationConfig</a></li><li><a href="global.html#generateAttackPath">generateAttackPath</a></li><li><a href="global.html#generateEntryPath">generateEntryPath</a></li><li><a href="global.html#getActiveSkin">getActiveSkin</a></li><li><a href="global.html#getEnemyHitbox">getEnemyHitbox</a></li><li><a href="global.html#getEnemyShotHitbox">getEnemyShotHitbox</a></li><li><a href="global.html#getEnemySkinImage">getEnemySkinImage</a></li><li><a href="global.html#getOwnedSkins">getOwnedSkins</a></li><li><a href="global.html#getPlayerHitbox">getPlayerHitbox</a></li><li><a href="global.html#getShotHitbox">getShotHitbox</a></li><li><a href="global.html#handleEnemyKilled">handleEnemyKilled</a></li><li><a href="global.html#handleLevelProgression">handleLevelProgression</a></li><li><a href="global.html#handlePlayerHit">handlePlayerHit</a></li><li><a href="global.html#initAudio">initAudio</a></li><li><a href="global.html#initBackground">initBackground</a></li><li><a href="global.html#initEnemyAttack">initEnemyAttack</a></li><li><a href="global.html#initEnemyModule">initEnemyModule</a></li><li><a href="global.html#initInput">initInput</a></li><li><a href="global.html#initPauseMenu">initPauseMenu</a></li><li><a href="global.html#initSharedAudio">initSharedAudio</a></li><li><a href="global.html#initShooting">initShooting</a></li><li><a href="global.html#initialized">initialized</a></li><li><a href="global.html#isGamePaused">isGamePaused</a></li><li><a href="global.html#isKeyPressed">isKeyPressed</a></li><li><a href="global.html#isSkinOwned">isSkinOwned</a></li><li><a href="global.html#killEnemy">killEnemy</a></li><li><a href="global.html#loadEnemySkinImage">loadEnemySkinImage</a></li><li><a href="global.html#loop">loop</a></li><li><a href="global.html#moveEnemyInFormation">moveEnemyInFormation</a></li><li><a href="global.html#playBackgroundGameMusic">playBackgroundGameMusic</a></li><li><a href="global.html#playIntroMusic">playIntroMusic</a></li><li><a href="global.html#pressedKeys">pressedKeys</a></li><li><a href="global.html#scheduleEnemyAttacks">scheduleEnemyAttacks</a></li><li><a href="global.html#selectAttackingEnemy">selectAttackingEnemy</a></li><li><a href="global.html#spawnEnemyWave">spawnEnemyWave</a></li><li><a href="global.html#stars">stars</a></li><li><a href="global.html#start">start</a></li><li><a href="global.html#startEnemyAttack">startEnemyAttack</a></li><li><a href="global.html#startNextLevel">startNextLevel</a></li><li><a href="global.html#togglePause">togglePause</a></li><li><a href="global.html#update">update</a></li><li><a href="global.html#updateAttackingEnemy">updateAttackingEnemy</a></li><li><a href="global.html#updateBackground">updateBackground</a></li><li><a href="global.html#updateEnemies">updateEnemies</a></li><li><a href="global.html#updateEnemyShots">updateEnemyShots</a></li><li><a href="global.html#updateInvincibility">updateInvincibility</a></li><li><a href="global.html#updateLevelTransition">updateLevelTransition</a></li><li><a href="global.html#updatePlayer">updatePlayer</a></li><li><a href="global.html#updatePlayerShots">updatePlayerShots</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Wed Dec 10 2025 19:57:24 GMT-0800 (Pacific Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
