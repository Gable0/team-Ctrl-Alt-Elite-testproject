<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: systems/collision/shotCollisions.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: systems/collision/shotCollisions.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// js/systems/collision/shotCollisions.js

import {
  getEnemyHitbox,
  getShotHitbox,
  getEnemyShotHitbox,
  getPlayerHitbox,
} from './hitboxes.js';
import { boxesOverlap } from './detection.js';

/**
 * Checks all active player shots for collisions with enemies.
 * When a hit occurs the enemy is marked as dying and the bullet is deactivated.
 * Supports optional callbacks for scoring, power-ups, etc.
 *
 * @param {Object} game - Global game state.
 * @param {function(Object): void} [onEnemyKilled] - Called when an enemy is hit (receives the enemy object).
 */
export function checkPlayerShotCollisions(game, onEnemyKilled) {
  if (!game.playerShots?.length || !game.enemies?.length) return;

  // Iterate backwards so we can safely remove bullets while looping
  for (let i = game.playerShots.length - 1; i >= 0; i--) {
    const shot = game.playerShots[i];
    if (!shot || shot.active === false) continue;

    const shotBox = getShotHitbox(shot);
    if (!shotBox) continue;

    let hitSomething = false;
    for (const enemy of game.enemies) {
      if (enemy.state === 'dying') continue;

      const enemyBox = getEnemyHitbox(enemy);
      if (boxesOverlap(shotBox, enemyBox)) {
        // Kill the enemy
        enemy.state = 'dying';
        enemy.dyingTimer = 0.3;

        // Deactivate the bullet (no piercing)
        shot.active = false;
        hitSomething = true;

        if (typeof onEnemyKilled === 'function') onEnemyKilled(enemy);
        if (typeof shot.onHit === 'function') shot.onHit(enemy);

        break; // One bullet = one hit
      }
    }
  }

  // Clean up inactive shots
  game.playerShots = game.playerShots.filter(s => s &amp;&amp; s.active !== false);
}

/**
 * Checks all active enemy shots for collisions with the player.
 *
 * @param {Object} game - Global game state.
 * @param {function(string): void} [onPlayerHit] - Called when the player is hit by a laser (receives hit type).
 * @returns {boolean} `true` if the player was hit this frame, otherwise `false`.
 */
export function checkEnemyShotCollisions(game, onPlayerHit) {
  if (!game.enemyShots?.length || !game.player) return false;

  const playerBox = getPlayerHitbox(game.player);

  for (let i = game.enemyShots.length - 1; i >= 0; i--) {
    const shot = game.enemyShots[i];
    const shotBox = getEnemyShotHitbox(shot);
    if (!shotBox) continue;

    if (boxesOverlap(shotBox, playerBox)) {
      game.enemyShots.splice(i, 1);
      if (typeof onPlayerHit === 'function') onPlayerHit('laser'); // Pass "laser" as hit type
      return true;
    }
  }
  return false;
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="PersistentAudioManager.html">PersistentAudioManager</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Game">Game</a></li><li><a href="global.html#advanceEnemyAlongPath">advanceEnemyAlongPath</a></li><li><a href="global.html#audioManager">audioManager</a></li><li><a href="global.html#barrierY">barrierY</a></li><li><a href="global.html#boxesOverlap">boxesOverlap</a></li><li><a href="global.html#canvas">canvas</a></li><li><a href="global.html#canvasRef">canvasRef</a></li><li><a href="global.html#checkEnemyShotCollisions">checkEnemyShotCollisions</a></li><li><a href="global.html#checkPlayerEnemyCollision">checkPlayerEnemyCollision</a></li><li><a href="global.html#checkPlayerShotCollisions">checkPlayerShotCollisions</a></li><li><a href="global.html#createEnemy">createEnemy</a></li><li><a href="global.html#createInitialGame">createInitialGame</a></li><li><a href="global.html#createPlayer">createPlayer</a></li><li><a href="global.html#createPlayerShot">createPlayerShot</a></li><li><a href="global.html#ctx">ctx</a></li><li><a href="global.html#ctxRef">ctxRef</a></li><li><a href="global.html#draw">draw</a></li><li><a href="global.html#drawBackground">drawBackground</a></li><li><a href="global.html#drawEnemies">drawEnemies</a></li><li><a href="global.html#drawEnemyShots">drawEnemyShots</a></li><li><a href="global.html#drawPlayer">drawPlayer</a></li><li><a href="global.html#drawPlayerShots">drawPlayerShots</a></li><li><a href="global.html#enemyTypes">enemyTypes</a></li><li><a href="global.html#equipSkin">equipSkin</a></li><li><a href="global.html#fireEnemyShot">fireEnemyShot</a></li><li><a href="global.html#formationConfig">formationConfig</a></li><li><a href="global.html#generateAttackPath">generateAttackPath</a></li><li><a href="global.html#generateEntryPath">generateEntryPath</a></li><li><a href="global.html#getActiveSkin">getActiveSkin</a></li><li><a href="global.html#getEnemyHitbox">getEnemyHitbox</a></li><li><a href="global.html#getEnemyShotHitbox">getEnemyShotHitbox</a></li><li><a href="global.html#getEnemySkinImage">getEnemySkinImage</a></li><li><a href="global.html#getOwnedSkins">getOwnedSkins</a></li><li><a href="global.html#getPlayerHitbox">getPlayerHitbox</a></li><li><a href="global.html#getShotHitbox">getShotHitbox</a></li><li><a href="global.html#handleEnemyKilled">handleEnemyKilled</a></li><li><a href="global.html#handleLevelProgression">handleLevelProgression</a></li><li><a href="global.html#handlePlayerHit">handlePlayerHit</a></li><li><a href="global.html#initAudio">initAudio</a></li><li><a href="global.html#initBackground">initBackground</a></li><li><a href="global.html#initEnemyAttack">initEnemyAttack</a></li><li><a href="global.html#initEnemyModule">initEnemyModule</a></li><li><a href="global.html#initInput">initInput</a></li><li><a href="global.html#initPauseMenu">initPauseMenu</a></li><li><a href="global.html#initSharedAudio">initSharedAudio</a></li><li><a href="global.html#initShooting">initShooting</a></li><li><a href="global.html#initialized">initialized</a></li><li><a href="global.html#isGamePaused">isGamePaused</a></li><li><a href="global.html#isKeyPressed">isKeyPressed</a></li><li><a href="global.html#isSkinOwned">isSkinOwned</a></li><li><a href="global.html#killEnemy">killEnemy</a></li><li><a href="global.html#loadEnemySkinImage">loadEnemySkinImage</a></li><li><a href="global.html#loop">loop</a></li><li><a href="global.html#moveEnemyInFormation">moveEnemyInFormation</a></li><li><a href="global.html#playBackgroundGameMusic">playBackgroundGameMusic</a></li><li><a href="global.html#playIntroMusic">playIntroMusic</a></li><li><a href="global.html#pressedKeys">pressedKeys</a></li><li><a href="global.html#scheduleEnemyAttacks">scheduleEnemyAttacks</a></li><li><a href="global.html#selectAttackingEnemy">selectAttackingEnemy</a></li><li><a href="global.html#spawnEnemyWave">spawnEnemyWave</a></li><li><a href="global.html#stars">stars</a></li><li><a href="global.html#start">start</a></li><li><a href="global.html#startEnemyAttack">startEnemyAttack</a></li><li><a href="global.html#startNextLevel">startNextLevel</a></li><li><a href="global.html#togglePause">togglePause</a></li><li><a href="global.html#update">update</a></li><li><a href="global.html#updateAttackingEnemy">updateAttackingEnemy</a></li><li><a href="global.html#updateBackground">updateBackground</a></li><li><a href="global.html#updateEnemies">updateEnemies</a></li><li><a href="global.html#updateEnemyShots">updateEnemyShots</a></li><li><a href="global.html#updateInvincibility">updateInvincibility</a></li><li><a href="global.html#updateLevelTransition">updateLevelTransition</a></li><li><a href="global.html#updatePlayer">updatePlayer</a></li><li><a href="global.html#updatePlayerShots">updatePlayerShots</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Wed Dec 10 2025 10:30:47 GMT-0800 (Pacific Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
