<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RetroGa</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Game page background elements -->
    <div class="game-scanlines"></div>
    <div class="game-grid-overlay"></div>

    <!-- Corner decorations -->
    <div class="game-corner-decoration top-left"></div>
    <div class="game-corner-decoration top-right"></div>
    <div class="game-corner-decoration bottom-left"></div>
    <div class="game-corner-decoration bottom-right"></div>

    <!-- Floating particles -->
    <div class="game-particle"></div>
    <div class="game-particle"></div>
    <div class="game-particle"></div>
    <div class="game-particle"></div>
    <div class="game-particle"></div>
    <div class="game-particle"></div>

    <!-- Power indicator -->
    <div class="game-power-indicator">
      <div class="game-power-dot"></div>
      <span class="game-power-text">SYSTEMS ONLINE</span>
    </div>

    <!-- Left side panel -->
    <div class="game-side-panel left">
      <div class="game-stat-display">
        <div class="game-stat-label">WAVE</div>
        <div class="game-stat-value" id="wave-display">1</div>
      </div>
      <div class="game-stat-display">
        <div class="game-stat-label">ENEMIES</div>
        <div class="game-stat-value" id="enemies-display">40</div>
      </div>
    </div>

    <!-- Right side panel -->
    <div class="game-side-panel right">
      <div class="game-stat-display">
        <div class="game-stat-label">HITS</div>
        <div class="game-stat-value" id="hits-display">0</div>
      </div>
      <div class="game-stat-display">
        <div class="game-stat-label">SHOTS</div>
        <div class="game-stat-value" id="shots-display">0</div>
      </div>
    </div>

    <main>
      <canvas
        id="game"
        width="800"
        height="600"
        aria-label="Galaga playfield"
      ></canvas>
      <section id="status">
        <p translate="moveInstructions">
          Use Arrow Keys or WASD to move the ship.
        </p>
        <p translate="fireInstructions">[Space] to fire.</p>
      </section>
    </main>

    <script type="module">
      import { injectSettings } from './js/ui/settingsComponent.js';
      import { persistentAudio } from './js/core/persistentAudio.js';
      injectSettings();
    </script>
    <script type="module" src="js/core/gameLoop.js"></script>
    <script type="module">
      import { applyTranslations } from './js/ui/translations.js';
      applyTranslations(document);
      window.addEventListener('languagechange', () =>
        applyTranslations(document)
      );
    </script>

    <!-- Update side panel stats from game state -->
    <script type="module">
      // Connect side panels to actual game state
      function updateGameStats() {
        // Wait for Game object to be available
        if (typeof window.Game === 'undefined') {
          setTimeout(updateGameStats, 100);
          return;
        }

        const waveDisplay = document.getElementById('wave-display');
        const enemiesDisplay = document.getElementById('enemies-display');
        const hitsDisplay = document.getElementById('hits-display');
        const shotsDisplay = document.getElementById('shots-display');

        // Cache previous values to avoid unnecessary DOM updates
        let prevWave = 0;
        let prevEnemies = 0;
        let prevHits = 0;
        let prevShots = 0;

        // Update display - only when values change
        function updateDisplay() {
          if (window.Game) {
            // Update wave (level) - only if changed
            const currentWave = window.Game.level || 1;
            if (currentWave !== prevWave) {
              waveDisplay.textContent = currentWave;
              prevWave = currentWave;
            }

            // Update enemy count - only if changed
            const currentEnemies = window.Game.enemies?.length || 0;
            if (currentEnemies !== prevEnemies) {
              enemiesDisplay.textContent = currentEnemies;
              prevEnemies = currentEnemies;
            }

            // Update hits (approximation based on score) - only if changed
            const currentHits = Math.floor((window.Game.score || 0) / 100);
            if (currentHits !== prevHits) {
              hitsDisplay.textContent = currentHits;
              prevHits = currentHits;
            }

            // Update shots - only if changed
            const currentShots = window.Game.shotsFired || 0;
            if (currentShots !== prevShots) {
              shotsDisplay.textContent = currentShots;
              prevShots = currentShots;
            }
          }
          requestAnimationFrame(updateDisplay);
        }

        updateDisplay();
      }

      // Start updating stats
      updateGameStats();
    </script>
  </body>
</html>
